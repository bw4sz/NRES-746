---
title: "Lab Exercise 2"
author: "NRES 746"
date: "September 9, 2016"
output: 
  html_document: 
    theme: cerulean
    toc: yes
    toc_float: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, cache = TRUE)
```


## Final Projects

Take some time to start forming groups (2-3 people) for final projects.

### General expectations

I will provide a more formal list of expectations for final projects soon, but in a nutshell (and in no particular order), you are expected to perform and write up the results for a sophisticated data analysis using *state-of-the-art analytical methods*. The write-up will loosely take the format of a scientific paper to be submitted to a professional journal. However, because of the nature of this course, the most important pieces of the write-up are the methods and results sections. Nonetheless, I expect at least a few paragraphs introducing the topic and why it's important, and a few paragraphs discussing the implications of the results. The methods and results section can (and in many cases should) be much longer than you typically see in a scientific paper- don't feel constrained by space for these sections! Not that you need to be wordy, I just want to make sure you have the space to clearly explain the analyses you performed and why you made the choices you did.  

### Picking a topic

Your final project should not be part of your thesis. That said, there is no requirement that your final project is not *relevant* to your graduate thesis project. You will end up spending quite a bit of time on your final projects, so think about what types of analyses you want/need to get to know better- ideally something that may strengthen your thesis project. 

### Picking a dataset

You are not required to use a public dataset, but there are lots of great datasets out there... see [links page](https://kevintshoemaker.github.io/NRES-746/Links.html#Data_links)

#### QUESTION 1
Develop a 1-page "proposal" that briefly describes your research question, your study system, the data set you will use, and what methods you plan to use to test your research question. Proposals are due to me by **Monday 26 September**. All groups should meet with me briefly to go over project ideas in lab on September 29!

## The Virtual Ecologist

This is the "real" lab exercise for this week! For the assignment, please keep your work as short and sweet as possible! **LAB 2 is due by midnight on Friday 9/30.**   

### Simulating Data in R

First, review the basic approach to simulating data in the ["Virtual Ecologist" lecture](https://kevintshoemaker.github.io/NRES-746/LECTURE3.html).

#### QUESTION 2 (model verification and goodness of fit)
Simulate data that meets all the standard assumptions of univariate linear regression (as performed with the "lm" function). Then run the "lm" function on these data and examine how closely the parameter estimates match the "true" parameter value. Other choices (sample size, parameter values etc) are up to you!

* Does the 95% confidence interval contain the true parameter value 95% of the time (a frequentist question!). Can you show this with simulations?
* Plot the estimated regression line with a 95% confidence interval around the regression line. Overlay the "true" regression line.
* Plot the estimated regression line with a 95% prediction interval. Overlay the "true" data. 

Note that you can use the 'predict' function to get confidence intervals and prediction intervals:

```{r, eval=FALSE}
predict.lm(yourmodel, interval = c("confidence"), level = 0.95)   # for confidence interval
predict.lm(yourmodel, interval = c("prediction"), level = 0.95)   # for prediction interval

```

* Can you write code to simulate the range of regression lines likely to be produced under the fitted model (i.e, within the 95% confidence interval)? Use this code to plot out a large number of replicate regression lines. Overlay the 95% confidence interval produced using the "predict" function. 

* Write code to simulate data under the fitted model (i.e, simulate data using the fitted parameter estimates and confidence intervals)? Use this code to plot out a large number of replicate regression lines. Overlay the 95% confidence interval produced using the "predict" function. 

#### QUESTION 3 (model verification #2)
Write an R function to generate data that violates *one or more* of the basic assumptions regarding the error distribution of standard linear regression. Make sure your dataset is realistic! Justify in writing how biological or sampling processes could have produced the data, including (especially) the assumptions violation(s). NOTE: you must specify a linear relationship between your response and predictor (otherwise some of the questions below wouldn't make sense!). 

Some options: 

* use a non-normal error distribution
* introduce temporal autocorrelation
* introduce other types of correlation structure among the observations
* introduce a high-leverage outlier 
* use a mixture of two error distributions
* others?? (feel free to be creative!)

Use classical linear regression to analyze these data. 

Answer the following questions (keep verbiage to a minimum, and provide all code- with comments!)

1. Is the estimate of the regression parameter *biased*? [note: statistical bias of an estimator is the difference between the estimator's expected value and the true value of the parameter being estimated]
2. Is the estimate of the error variance biased?
2. How well does the *confidence interval* for the regression parameter match the true confidence interval for the regression parameter? (this is a test for *precision*)
3. Try some common data transformations to correct for any assumptions violations. For example, you might log transform, arcsine transform, logit transform, etc... Do these transformations improve the degree to which the regression analysis estimates match the 
4. Can you develop a R routine to simulate data from the model and develop a 95% *prediction interval* - that is, the interval beyond which only 5% of your observations are likely to fall. The analytical formula for the prediction interval is:
   $prediction interval formula$
Do your simulation results match the prediction interval above? 
5. Evaluate *goodness-of-fit* by visualizing the (fake, untransformed) data against the range of data likely to be produced under the regression model. Were your data


#### QUESTION 3
Power analysis. 




















